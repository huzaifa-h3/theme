{% liquid
  # Reusable product card snippet
%}
{{ 'product-card.css' | asset_url | stylesheet_tag }}
{%- assign discount = product.compare_at_price_max | minus: product.price -%}
{%- assign discount_percentage = discount | times: 100 | divided_by: product.compare_at_price_max -%}
{% assign product_availability = product.available %}

<div class="product__card">
  <a href="{{ product.url | escape }}" class="product__link">
    <div class="product_quick-actions">
      {% if product_availability %}
        {% form 'product', product, class: 'add-to-cart-form', data-product-id: product.id %}
          <input type="hidden" name="id" value="{{ product.variants.first.id }}">
          <input type="hidden" name="quantity" value="1">
          <button
            type="submit"
            class="quick_add"
            data-variant-id="{{ product.variants.first.id }}"
            data-loading-icon="{{ 'loading.png' | asset_url }}"
            data-added-icon="{{ 'added-to-cart.png' | asset_url }}"
            data-default-icon="{{ 'add-to-cart.png' | asset_url }}"
            data-success-timeout="1000"
            aria-label="Add to cart"
          >
            <img src="{{ 'add-to-cart.png' | asset_url }}" alt="Add to cart" height="24" width="24">
          </button>
        {% endform %}
      {% else %}
        <button type="button" class="quick_add" disabled aria-disabled="true" aria-label="Sold out">
          <img src="{{ 'icon-sold-out.png' | asset_url }}" alt="Sold out" height="24" width="24">
        </button>
      {% endif %}
    </div>
    <div class="product-image-container">
      {% if product.images.size > 1 %}
        <div class="product-swiper-{{ product.id }} swiper">
          <div class="swiper-wrapper">
            {% for image in product.images %}
              <div class="swiper-slide product_images">
                <img
                  src="{{ image | image_url }}"
                  alt="{{ product.title | escape }}"
                  class="product_image"
                  loading="lazy"
                  height=""
                  width=""
                >
                {% if product.compare_at_price_max > product.price %}
                  <div class="product_on-sale product-badge">-{{ discount_percentage }}%</div>
                {% endif %}
                {% if product_availability == false %}
                  <div class="product_soldout product-badge">SOLD</div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        </div>
      {% else %}
        {% if product.featured_image %}
          <div class="product-swiper-single swiper">
            <div class="swiper-wrapper">
              <div class="swiper-slide product_images">
                <img
                  src="{{ product.featured_image | image_url }}"
                  alt="{{ product.title | escape }}"
                  class="product_image"
                  loading="lazy"
                  height=""
                  width=""
                >
                {% if product.compare_at_price_max > product.price %}
                  <div class="product_on-sale product-badge">-{{ discount_percentage }}%</div>
                {% endif %}
                {% if product_availability == false %}
                  <div class="product_soldout product-badge">SOLD</div>
                {% endif %}
              </div>
            </div>
          </div>
        {% else %}
          {{ 'no-image' | placeholder_svg_tag: 'product_image' }}
        {% endif %}
      {% endif %}
    </div>

    <!-- product info -->
    <div class="product__info">
      {% comment %} Product Name/Title {% endcomment %}
      <h5 class="product_title">{{ product.title | truncate: 25 | escape }}</h5>

      {% comment %} Product price {% endcomment %}
      {% if product.compare_at_price_max > product.price %}
        <div class="product_prices">
          <span class="compare_at_price">{{ product.compare_at_price_max | money_with_currency }}</span>
          <p>{{ product.price | money_with_currency }}</p>
        </div>
      {% else %}
        <p>{{ product.price | money_with_currency }}</p>
      {% endif %}
      {% comment %} Product Vendor {% endcomment %}
      {% if product.vendor %}
        <div class="product-vendor">
          <span>{{ product.vendor }}</span>
        </div>
      {% endif %}
    </div>
  </a>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize swiper for specific product
    const swiperElement = document.querySelector('.product-swiper-{{ product.id }}');
    if (swiperElement) {
      new Swiper(swiperElement, {
        slidesPerView: 1,
        spaceBetween: 0,
        loop: true,
        speed: 400,
        keyboard: {
          enabled: true,
          onlyInViewport: true,
        },
        a11y: {
          enabled: true,
          prevSlideMessage: 'Previous slide',
          nextSlideMessage: 'Next slide',
        },
      });
    }
  });
</script>
