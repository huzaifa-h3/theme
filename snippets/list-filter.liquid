<div class="list-filter">
  <div class="available-filters">
    <form id="CollectionFiltersForm">
      {% for filter in collection.filters %}
        <div class="filter-box">
          <details>
            <summary aria-label="{{ filter.label }}">{{ filter.label }}</summary>
            <ul class="filter-underlist" role="listbox" aria-label="{{ filter.label }}">
              {% for value in filter.values %}
                <li class="filter">
                  <input
                    type="checkbox"
                    name="{{ filter.param_name }}"
                    value="{{ value.value }}"
                    id="{{ filter.param_name }}-{{ forloop.index }}"
                    {% if value.active %}
                      checked
                    {% endif %}
                  >
                  <label for="{{ filter.param_name }}-{{ forloop.index }}">{{ value.label }}</label>
                </li>
              {% endfor %}
            </ul>
          </details>
          <button class="filter-chevron-down" style="border: none;" type="button" aria-label="Expand filter">
            <img src="{{ 'chevron-down.svg' | asset_url }}" height="auto" width="12" alt="Expand">
          </button>
          {% if filter.active_values.size > 0 %}
            <button type="button" class="clearFilter">Clear</button>
          {% endif %}
        </div>
      {% endfor %}
    </form>
  </div>

  <div class="sort-filter">
    <form id="CollectionSortForm">
      <details>
        <summary class="summary-bar" aria-label="Sort products">
          <span style="white-space: nowrap;">
            {%- if collection.products_count < 1 %} {{ collection.products_count }} item {% endif %}
            {{ collection.products_count }} items
          </span>
          Sort
        </summary>
        <ul class="sort" role="listbox" aria-label="Sort options">
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="manual"
                {% if collection.sort_by == 'manual' %}
                  checked
                {% endif %}
              >
              Featured</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="best-selling"
                {% if collection.sort_by == 'best-selling' %}
                  checked
                {% endif %}
              >
              Best Selling</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="title-ascending"
                {% if collection.sort_by == 'title-ascending' %}
                  checked
                {% endif %}
              >
              Alphabetically, A-Z</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="title-descending"
                {% if collection.sort_by == 'title-descending' %}
                  checked
                {% endif %}
              >
              Alphabetically, Z-A</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="price-ascending"
                {% if collection.sort_by == 'price-ascending' %}
                  checked
                {% endif %}
              >
              Price, low to high</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="price-descending"
                {% if collection.sort_by == 'price-descending' %}
                  checked
                {% endif %}
              >
              Price, high to low</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="created-ascending"
                {% if collection.sort_by == 'created-ascending' %}
                  checked
                {% endif %}
              >
              Date, old to new</label
            >
          </li>
          <li>
            <label
              ><input
                type="radio"
                name="sort_by"
                value="created-descending"
                {% if collection.sort_by == 'created-descending' %}
                  checked
                {% endif %}
              >
              Date, new to old</label
            >
          </li>
        </ul>
      </details>
      <button class="filter-chevron-down" style="border: none;" type="button" aria-label="Expand sort options">
        <img src="{{ 'chevron-down.svg' | asset_url }}" height="21" width="12" alt="Expand">
      </button>
    </form>
  </div>
</div>

<script>
  // Filters submit
  document.querySelectorAll('#CollectionFiltersForm input[type="checkbox"]').forEach((checkbox) => {
    checkbox.addEventListener('change', () => {
      document.getElementById('CollectionFiltersForm').submit();
    });
  });

  // Sorting submit
  document.querySelectorAll('#CollectionSortForm input[name="sort_by"]').forEach((radio) => {
    radio.addEventListener('change', () => {
      document.getElementById('CollectionSortForm').submit();
    });
  });
</script>

<style>
  .list-filter {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 2px;
    margin-bottom: 20px;
    width: 100%;
    border-bottom: 1px solid lightgray;
  }
  .available-filters {
    padding-bottom: 0px;
    width: 100%;
  }
  #CollectionFiltersForm {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 15px;
  }
  .filter-box {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  details {
    position: relative;
    width: 100%;
    font-size: var(--font-size-xs);
  }
  .filter-underlist {
    padding: 15px;
    background: #ffffff;
    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
    height: fit-content;
    border-radius: 10px;
    position: absolute;
    z-index: 999;
    min-width: 190px;
    width: 100%;
    right: auto;
    top: auto;
  }
  .filter {
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }
  .filter label {
    margin-left: 5px;
    width: 100%;
    padding: 3px 0;
    font-size: var(--font-size-xs);
  }
  .sort-filter {
    width: auto;
    position: relative;
    display: flex;
    gap: 5px;
  }
  .sort-filter details ul {
    padding: 20px;
    background: #ffffff;
    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
    height: fit-content;
    border-radius: 10px;
    position: absolute;
    z-index: 999;
    width: 220px;
    right: -18%;
    top: auto;
  }
  .sort li p {
    padding: 3px 0;
    font-size: var(--font-size-xs);
  }
  .summary-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    gap: 10px;
  }
  .summary-bar span {
    font-size: var(--font-size-xs);
    color: gray;
  }
  .clearFilter{
    font-size: var(--font-size-xs);
    border: none;
    padding: 0px;
    font-weight: bold;
  }
</style>
